<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ARPEGGIO Stroke Trial Eligibility</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5faff; color: #333; }
    h1, h2 { color: #00557f; }
    .logo-bar { display: flex; justify-content: space-around; align-items: center; margin-bottom: 30px; }
    .logo-bar img { height: 60px; }
    .section { margin-bottom: 25px; }
    label.question { font-weight: bold; display: block; margin-bottom: 8px; }
    .radio-group { margin-bottom: 15px; }

    /* Pill-style Yes/No buttons */
    .choice {
      display: inline-flex;
      align-items: center;
      padding: 0.4rem 0.8rem;
      margin-right: 0.4rem;
      font-size: 0.85rem;
      border-radius: 0.2rem;
      cursor: pointer;
      user-select: none;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
      border: 2px solid transparent;
      position: relative;
    }
    .choice input {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }
    .choice:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .choice:active { transform: translateY(0); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .choice.yes { background: #e6ffed; border-color: #28a745; color: #155724; }
    .choice.no  { background: #ffe6e6; border-color: #dc3545; color: #721c24; }
    .choice input:checked + span { outline: 3px solid rgba(0,0,0,0.15); }

    /* Main action buttons */
    button {
      padding: 0.75rem 1.5rem;
      margin: 5px;
      background-color: #00557f;
      color: white;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.1s ease, background-color 0.2s ease;
    }
    button:hover { background-color: #004766; transform: translateY(-1px); }
    button:active { transform: translateY(0); }

    /* Results styling */
    #results { margin-top: 30px; padding: 15px; border: 1px solid #ccc; background: #fff; }
    #timestamp { margin-top: 10px; font-size: 0.9em; color: #555; }
    #backButton { display: none; margin-top: 20px; }
    .met { color: green; font-weight: bold; }
    .not-met { color: red; font-weight: bold; }

    @media print {
      body { background: white; color: black; font-size: 12px; margin: 20mm; }
      .logo-bar, form button, #backButton { display: none; }
      header, footer { display: block; text-align: center; font-size: 0.9em; margin: 5px 0; }
    }
    header, footer { display: none; }
  </style>
</head>
<body>
<header>Confidential - Study Screening Tool</header>
<div class="logo-bar">
  <img src="images/logo1.png" alt="Logo 1">
  <img src="images/logo2.png" alt="Logo 2">
</div>
<h1>ARPEGGIO Stroke Trial Eligibility Checklist</h1>
<form id="eligibilityForm" name="eligibilityForm">
  <!-- Inclusion Criteria -->
  <div class="section">
    <h2>Inclusion Criteria</h2>
    <!-- 1 -->
    <div class="radio-group">
      <label class="question">1. Age ≥ 18 years.</label>
      <label class="choice yes"><input type="radio" name="inclusion1" value="yes"><span>Yes</span></label>
      <label class="choice no"><input type="radio" name="inclusion1" value="no"><span>No</span></label>
    </div>
    <!-- 2 -->
    <div class="radio-group">
      <label class="question">2. Body weight &lt; 150 kg.</label>
      <label class="choice yes"><input type="radio" name="inclusion2" value="yes"><span>Yes</span></label>
      <label class="choice no"><input type="radio" name="inclusion2" value="no"><span>No</span></label>
    </div>
    <!-- 3 -->
    <div class="radio-group">
      <label class="question">3. AIS intended for immediate endovascular treatment.</label>
      <label class="choice yes"><input type="radio" name="inclusion3" value="yes"><span>Yes</span></label>
      <label class="choice no"><input type="radio" name="inclusion3" value="no"><span>No</span></label>
    </div>
    <!-- 4 -->
    <div class="radio-group">
      <label class="question">4. Disabling stroke: NIHSS ≥ 6 at randomization.</label>
      <label class="choice yes"><input type="radio" name="inclusion4" value="yes"><span>Yes</span></label>
      <label class="choice no"><input type="radio" name="inclusion4" value="no"><span>No</span></label>
    </div>
    <!-- 5 -->
    <div class="radio-group">
      <label class="question">5. Confirmed symptomatic ICA, M1, or M2 occlusion.</label>
      <label class="choice yes"><input type="radio" name="inclusion5" value="yes"><span>Yes</span></label>
      <label class="choice no"><input type="radio" name="inclusion5" value="no"><span>No</span></label>
    </div>
    <!-- 6 -->
    <div class="radio-group">
      <label class="question">6. Onset-to-randomization ≤ 24 h.</label>
      <label class="choice yes"><input type="radio" name="inclusion6" value="yes"><span>Yes</span></label>
      <label class="choice no"><input type="radio" name="inclusion6" value="no"><span>No</span></label>
    </div>
    <!-- 7 -->
    <div class="radio-group">
      <label class="question">7. Planned EVT with an FDA-approved device.</label>
      <label class="choice yes"><input type="radio" name="inclusion7" value="yes"><span>Yes</span></label>
      <label class="choice no"><input type="radio" name="inclusion7" value="no"><span>No</span></label>
    </div>
    <!-- 8 -->
    <div class="radio-group">
      <label class="question">8. Pre-AIS mRS 0–2, living independently.</label>
      <label class="choice yes"><input type="radio" name="inclusion8" value="yes"><span>Yes</span></label>
      <label class="choice no"><input type="radio" name="inclusion8" value="no"><span>No</span></label>
    </div>
    <!-- 9 -->
    <div class="radio-group">
      <label class="question">9. Treating team & family committed to full medical support.</label>
      <label class="choice yes"><input type="radio" name="inclusion9" value="yes"><span>Yes</span></label>
      <label class="choice no"><input type="radio" name="inclusion9" value="no"><span>No</span></label>
    </div>
    <!-- 10 -->
    <div class="radio-group">
      <label class="question">10. Signed informed consent from subject or LAR.</label>
      <label class="choice yes"><input type="radio" name="inclusion10" value="yes"><span>Yes</span></label>
      <label class="choice no"><input type="radio" name="inclusion10" value="no"><span>No</span></label>
    </div>
    <!-- 11 -->
    <div class="radio-group">
      <label class="question">11. Female: surgically sterile, post-menopause, or using contraception.</label>
      <label class="choice yes"><input type="radio" name="inclusion11" value="yes"><span>Yes</span></label>
      <label class="choice no"><input type="radio" name="inclusion11" value="no"><span>No</span></label>
    </div>
    <!-- 12 -->
    <div class="radio-group">
      <label class="question">12. Male: sterile, using acceptable birth control, or abstinent.</label>
      <label class="choice yes"><input type="radio" name="inclusion12" value="yes"><span>Yes</span></label>
      <label class="choice no"><input type="radio" name="inclusion12" value="no"><span>No</span></label>
    </div>
  </div>

  <!-- Exclusion Criteria -->
     <!-- Exclusion Criteria -->
    <div class="section">
      <h2>Exclusion Criteria</h2>
      <!-- 1 -->
      <div class="radio-group">
        <label class="question">1. Acute ICH on qualifying imaging.</label>
        <label class="choice yes"><input type="radio" name="exclusion1" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion1" value="no"><span>No</span></label>
      </div>
      <!-- 2 -->
      <div class="radio-group">
        <label class="question">2. Poor or no collateral circulation (investigator judgment).</label>
        <label class="choice yes"><input type="radio" name="exclusion2" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion2" value="no"><span>No</span></label>
      </div>
      <!-- 3 -->
      <div class="radio-group">
        <label class="question">3. ASPECTS 0–4.</label>
        <label class="choice yes"><input type="radio" name="exclusion3" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion3" value="no"><span>No</span></label>
      </div>
      <!-- 4 -->
      <div class="radio-group">
        <label class="question">4. IV thrombolysis within prior 24 h.</label>
        <label class="choice yes"><input type="radio" name="exclusion4" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion4" value="no"><span>No</span></label>
      </div>
      <!-- 5 -->
      <div class="radio-group">
        <label class="question">5. Intent to use non-FDA-approved EVT device.</label>
        <label class="choice yes"><input type="radio" name="exclusion5" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion5" value="no"><span>No</span></label>
      </div>
      <!-- 6 -->
      <div class="radio-group">
        <label class="question">6. Planned intra-arterial thrombolytic therapy.</label>
        <label class="choice yes"><input type="radio" name="exclusion6" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion6" value="no"><span>No</span></label>
      </div>
      <!-- 7 -->
      <div class="radio-group">
        <label class="question">7. Severe contrast allergy / contraindication to iodinated contrast.</label>
        <label class="choice yes"><input type="radio" name="exclusion7" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion7" value="no"><span>No</span></label>
      </div>
      <!-- 8 -->
      <div class="radio-group">
        <label class="question">8. Suspected chronic occlusion or dissection suggesting poor EVT success.</label>
        <label class="choice yes"><input type="radio" name="exclusion8" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion8" value="no"><span>No</span></label>
      </div>
      <!-- 9 -->
      <div class="radio-group">
        <label class="question">9. Arterial condition preventing device use (e.g., aortic dissection, carotid stent).</label>
        <label class="choice yes"><input type="radio" name="exclusion9" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion9" value="no"><span>No</span></label>
      </div>
      <!-- 10 -->
      <div class="radio-group">
        <label class="question">10. End-stage kidney disease.</label>
        <label class="choice yes"><input type="radio" name="exclusion10" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion10" value="no"><span>No</span></label>
      </div>
      <!-- 11 -->
      <div class="radio-group">
        <label class="question">11. Anticoagulant-specific exclusions not met (see protocol).</label>
        <label class="choice yes"><input type="radio" name="exclusion11" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion11" value="no"><span>No</span></label>
      </div>
      <!-- 12 -->
      <div class="radio-group">
        <label class="question">12. Metastatic malignancy with poor prognosis.</label>
        <label class="choice yes"><input type="radio" name="exclusion12" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion12" value="no"><span>No</span></label>
      </div>
      <!-- 13 -->
      <div class="radio-group">
        <label class="question">13. Comorbidities precluding neuro assessment or follow-up.</label>
        <label class="choice yes"><input type="radio" name="exclusion13" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion13" value="no"><span>No</span></label>
      </div>
      <!-- 14 -->
      <div class="radio-group">
        <label class="question">14. Clinical-trial participation within 30 days.</label>
        <label class="choice yes"><input type="radio" name="exclusion14" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion14" value="no"><span>No</span></label>
      </div>
      <!-- 15 -->
      <div class="radio-group">
        <label class="question">15. Prior SCP-CL-0001/2/3 trial drug exposure.</label>
        <label class="choice yes"><input type="radio" name="exclusion15" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion15" value="no"><span>No</span></label>
      </div>
      <!-- 16 -->
      <div class="radio-group">
        <label class="question">16. Moderate/severe hypotension (SBP &lt; 90 mmHg) needing intervention.</label>
        <label class="choice yes"><input type="radio" name="exclusion16" value="yes"><span>Yes</span></label>
        <label class="choice no"><input type="radio" name="exclusion16" value="no"><span>No</span></label>
      </div>
    </div>

    <!-- Action Buttons -->
    <button type="button" onclick="checkEligibility()">Check Eligibility</button>
    <button type="button" onclick="printResults()">Print Results</button>
    <button type="button" onclick="downloadPDF()">Download as PDF</button>
  </form>

  <div id="results"></div>
  <div id="timestamp"></div>
  <button id="backButton" onclick="restoreForm()">Back to Form</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    function checkEligibility() {
      const form = document.forms["eligibilityForm"];
      let inclusionMet = true;
      let exclusionViolated = false;
      let resultHtml = '<h2>Eligibility Result</h2><ul>';

      // Inclusions 1–12
      for (let i = 1; i <= 12; i++) {
        const val = form['inclusion' + i].value;
        resultHtml += `<li>Inclusion ${i}: ${val === 'yes' ? '<span class="met">Met</span>' : '<span class="not-met">Not Met</span>'}`;
        if (val !== 'yes') inclusionMet = false;
      }

      // Exclusions 1–16
      for (let i = 1; i <= 16; i++) {
        const val = form['exclusion' + i].value;
        resultHtml += `<li>Exclusion ${i}: ${val === 'no' ? '<span class="met">Not Present</span>' : '<span class="not-met">Present</span>'}`;
        if (val === 'yes') exclusionViolated = true;
      }

      resultHtml += '</ul>';
      resultHtml += `<h3>${inclusionMet && !exclusionViolated ? '<span class="met">Eligible for Study</span>' : '<span class="not-met">Not Eligible for Study</span>'}</h3>`;

      document.getElementById("results").innerHTML = resultHtml;
      document.getElementById("timestamp").innerText = 'Results generated on: ' + new Date().toLocaleString();
      document.getElementById("backButton").style.display = 'block';
    }

    function printResults() {
      window.print();
    }

async function downloadPDF() {
  // 1) Temporarily bump up the results container width so html2canvas sees more horizontal space
  const results = document.getElementById('results');
  const originalWidth = results.style.width;
  results.style.width = '800px';  // or whatever pixel width matches a full PDF page

  // 2) Capture at higher dpi
  const canvas = await html2canvas(results, { scale: 3 });
  results.style.width = originalWidth;  // restore original

  const imgData = canvas.toDataURL('image/png');
  const { jsPDF } = window.jspdf;
  // 3) Create a standard letter-sized PDF
  const doc = new jsPDF({ unit: 'pt', format: 'letter' });
  const pageW = doc.internal.pageSize.getWidth();
  const pageH = doc.internal.pageSize.getHeight();

  // 4) Calculate height to maintain aspect ratio
  const imgProps = doc.getImageProperties(imgData);
  const imgH = (imgProps.height * pageW) / imgProps.width;

  // 5) Draw full-width, centered vertically
  doc.addImage(imgData, 'PNG', 0, (pageH - imgH) / 2, pageW, imgH);
  doc.save(`eligibility_${new Date().toISOString().slice(0,10)}.pdf`);
}

        function restoreForm() {
      location.reload();
    }
  </script>
</body>
</html>

